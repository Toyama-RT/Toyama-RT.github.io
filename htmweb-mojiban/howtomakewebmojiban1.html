<!DOCTYPE html>
<html lang="ja"><head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z7DXKP3EBK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z7DXKP3EBK');
</script>

  
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  
  <script type="text/javascript" src="../sh/scripts/shCore.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushXml.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushPlain.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushJScript.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushVb.js"></script>
  
  <link type="text/css" rel="stylesheet" href="../sh/styles/shCoreDefault.css">
  
  <script type="text/javascript">SyntaxHighlighter.all();</script>
  <title>HTMWebMoji１｜富山県リハ病院こども支援センター</title>
  
  <style type="text/css">
<!--
      
p	{
      font-size: 20px;
      line-height : 1.75 ;
      margin: 15px 100px 15px 100px;
	}
h1 {
    text-align: center;
    }
h2 {
    text-align: left;
      margin-left: 100px;
    }
h3 {
    text-align: left;
      margin-left: 100px;
    }
h4 {
    text-align: left;
      margin-left: 120px;
    }
pre {
    font-size: 20px;
    margin: 5px 100px 15px 100px;
    }
address{
	margin:5px 100px 15px 100px;
}      
blockquote {
    position: relative;
      font-size: 20px;
      line-height : 1.5 ;
    padding: 15px 100px 15px 100px;
    box-sizing: border-box;
    font-style: italic;
}
ol {
}
ul {
}
li {
  margin-top: 5px; /* 上余白指定 */
  margin-bottom: 5px; /* 下余白指定 */
  margin-left: 100px; /* 左余白指定*/
  margin-right: 100px; /* 右余白指定 */
  font-size: 20px; /*リストのフォントの大きさ*/
}
button{
  margin-bottom:1rem;
  width:150px;
  height:100px;
}

span.samples {font-size: small; }
.syntaxhighlighter {
  width: 80% !important;
  margin: 1em 100px 1em 100px !important;
  position: relative !important;
  overflow: auto !important;
  font-size: 1.3em !important;
}

    #text1 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn1 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice1 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;

    }
    #text2 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn2 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice2 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;

    }
    #text3 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn3 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice3 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;
    }
    canvas { border: 1px solid black; }


-->
  </style>

</head><body>
<p align="center"><font size="5"><font size="5"><font size="3"><font color="#ff0000">かならずお読みください</font>→<a href="../cyuui.html" target="_self"><img alt="注意事項" src="../cyuuijikou.gif" border="0" height="29" width="78"></a></font></font></font></p>

<h1>Web文字盤のつくりかた　１</h1>
<div style="text-align: center;">
<img title="Web文字盤を作る際の様子" alt="作業風景" src="img/figkonnafuuni.png">
<p>こんなふうにつくっています</P> 
</div>

<h2>０　はじめに</h2>
<p>
前回まで『ウェブアプリのつくりかた』をお送りしました。いかがだったでしょうか。
</p><p>
何回かに分けて、ウェブアプリの紹介から始まり、その特徴を活かしたコミュニケーション支援アプリの製作やユーザへの届け方などについてお話をしました。
また、アプリの機能を実現する情報技術やこれらの活動を経済的に維持継続するためにできるだけ機械（情報機器）やインターネットに仕事をさせる方法についても解説してきました。
</p><p>
ウェブアプリとして製作した『Web文字盤』が従来のコミュニケーション機器と最も異なるところは、このようなところです。機能それ自体は平凡な昔からあるものを形を変えて盛り込んであるただそれだけです。
</p><p>
ですからさらにこれを改造や改善を追加して、新しい仕組みや機能を盛り込むことも十分できると思います。またそのようなことをやっていただいても、私はとくに構いません。
やれ権利がとか、ロイヤリティーがとか、フィーとかいうはなしはありません。
</p><p>
またこのようなやり方は、これまで人手や資金の不足などのために実現が難しかった夢または幻の事案にひとつの解決策を示すこともできるかもしれません。

この他、いま皆さんの頭の中にあるアイデアをかたちあるものにして、実際に試す、試してもらうことができるようにするための方法として、企画や計画を進めるための方法としてもこのようなやり方は有用であると考えています。
</p><p>
このお話は、このようにして『できない』『不可能』『困難』などの壁でお困りの方々の役に立つものです。多くの方々に取り組んでいただき、突破していただきたいと思っています。
</p><p>
さて、Web文字盤を作り出した概念についてホンワカした、柔らかいお話を続けてきました。
今回からはこれに引き続いて、具体的でギスギスしたお話、つまり現在のWeb文字盤がもつ機能を実現するために具体的にどのように作っているのか（苦しんでいるのか）を説明していきたいと思います。このため慣れないと読み進むのが難しいかもしれませんが、頑張ってください。とかく役に立つ話は難しいものです。そして難しくても役に立たない話もあるところが困ったところなのです。
</p><p>
もしかしたら、すでに自分でも手作りに取り組んでおられる皆さんの参考またはお手伝いになるのではないか思います。
</p>
<h2>１　htmlファイル　hcj.html</h2>
<p>
ウェブアプリもウェブサイトと同じく、htmlファイルから始まります。ウェブ文字盤では、hcj.htmlというファイルです。使用している言語は同じですが、いろいろ工夫もあります。例えばこの出だしです。

</p><p>

<pre class="brush:html first-line:1;">
&lt;!DOCTYPE html>
&lt;html>
&lt;head>

<!-- for iOS  アドレスバー等のブラウザのUIを非表示 -->
<meta name="apple-mobile-web-app-capable" content="yes">
<!-- default（Safariと同じ） / black（黒） / black-translucent（ステータスバーをコンテンツに含める） -->
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<!-- ホーム画面に表示されるアプリ名 -->
<meta name="apple-mobile-web-app-title" content="Web Mojiban 4d">
<!-- ホーム画面に表示されるアプリアイコン -->
<link rel="apple-touch-icon" href="./ico/talk192.png">
 </pre>
</p><p>
はじめの３行はおなじみのとおりです。<br>
続くmetaタグではiOSのブラウザSafariでの表示を設定しています。<br>
6行目は、URLバーなどを非表示にして、ネイティブアプリのような外見にします。<br>
8行目は、ステータスバーの色を黒に指定しています。<br>
10行目は、ステータスバーに表示するタイトルを指定しています。<br>
これらの指定は、WebアプリをiOSのSafariから「ホーム画面に追加」し、ホーム画面に置かれたアイコンをタップすると、単体のアプリ風に立ち上げます。
</p>
<div style="text-align: center;">
<img title="使用しているアイコン" alt="アイコン" src="img/talk192.png">
</div>
<p>
アイコンに指定した、talk192.png　とは上の画像です。このあたりは、iOSのSafariでも他の場合と同じように動かすための手続きです。

</p><p>
<pre class="brush:html first-line:13;">
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>HCJLC3T</title>
    <link rel="stylesheet" href="style.css" type="text/css">
</pre>

</p><p>
この部分<br>
13行目は、主に使用しているのが、東アジアの２バイト文字（utf-8）であるとの指定。<br>
14行目は、html文のタイトルで通常これがタイトルバーに表示されます。検索サイトではこれが表示されます。<br>
15行目は、スタイルシートとして読み込むファイル、style.cssを指定しています。
</p><p>
<pre class="brush:js first-line:16;">
<!-- for PWA マニフェストファイル読み込み -->
    <link rel="manifest" href="./manifest2.webmanifest">

<!-- ios icon 表示対策 pwacompat -->

<script async src="https://cdn.jsdelivr.net/npm/pwacompat@2.0.9/pwacompat.min.js"
    integrity="sha384-VcI6S+HIsE80FVM1jgbd6WDFhzKYA0PecD/LcIyMQpT4fMJdijBh0I7Iblaacawc"
    crossorigin="anonymous"></script>
</pre>
</p><p>
</p><p>
</p><p>
次に、オフラインウェブアプリ、PWAのためのマニフェストファイルを読み込みます。<br>
17行目のmanifest2.webmanifest　を読み込むのですが、これの説明は後にします。<br>
これを手掛けた、数年前は、ｉOS　SafariはまだPWAへの対応が十分でなくマニフェストファイルによるホーム画面へのアイコン追加に対応していませんでした。
これを補うために、PWACompatを実装します。それが、21行目です。

</p><p>
<pre class="brush:html first-line:22;">
<!-- for PWA servive worker  オフライン動作用サービスワーカー読み込み -->
<script>
var path = `https://toyama-rt.github.io/web-mojiban/T/hcjlc3`;

      if('serviceWorker' in navigator) {
        navigator.serviceWorker.register(path + '/sw.js', { scope: path + '/' })
          .then(function(registration) {
                console.log('Service Worker Registered lc3');
          });
           navigator.serviceWorker.ready.then(function(registration) {
           console.log('Service Worker Ready lc3');
        });
      }
</script>
</pre>
</p><p>
サービスワーカー自体は、27行目のsw.jsで、JavaScriptで書かれています。ただサービスワーカーはフルパス（FullPath）でないと読めない（24行目）とか、httpsのサイトからでないと動かないとかいろいろむつかしいところがあります。
</p><p>
当時職場のサーバはhttpだったのでしかたなく無料のgithubのアカウントを取得しました。そちらのサーバでテストを開始し現在でもそのままです。<br>
26-30行目、サービスワーカー、sw.jsを読み込んで登録できたらコンソールに'Service Worker Registered lc3'と表示させています。<br>
同じく31-34行で、サービスワーカーの準備ができたら'Service Worker Ready lc3'と表示させています。<br>
このあたりは、動作が正常にできていることを確認するための工夫です。この部分は先人の知恵を拝借しましたので、比較的きれいなコードになっています。
ちなみに、23-35行はJavaScriptで書かれていて、それがhtmlの中にはめ込まれています。こんな使い方もできるのです。
</p><p>
<pre class="brush:html first-line:36;">
<!-- 文字盤動作用スクリプト読み込み -->
    <script type="text/javascript" src="./test.js"></script>

&lt;/head>
</pre>
</p><p>
Web文字盤のプログラムは、test.jsにJavaScriptで書かれています。<br>
37行目ではそれを読み込んでいます。test.jsはかなり大きいので説明は別の機会にします。<br>
3行目から39行目が、head（つまり下準備）になります。

ここからはbodyで表示関係の記載が始まります。
</p><p>
<pre class="brush:html first-line:40;">
&lt;body>
<span id="winsize2"></span> <!-- 画面幅高、表示部分 -->
</pre>
</p><p>
まず画面全体にid、"winsize2"を設定しました。これは使用しているモニター、パソコンではwindowの大きさ（dot数）を計測、表示させるときにこのidを使用しました。実際の表示はtest.jsでやりました。
スマホやタブレットの様々な寸法のモニタでの表示テストをパソコンでするためには、現状の表示dot数を把握する機能が必要でしたが、利用できるツールがなかったので、結局自分で作りました。足りない部品は自分で作るところが自動車の改造みたいですね。
</p><p>
<pre class="brush:html first-line:42;">
<!-- テキストエリアの配置 -->
<textarea id="text1" placeholder="" cols="50" rows="3" ></textarea>
</pre>
</p><p>
入力した文字列を表示するテキストエリアを設定しています。<br>
idは"text1"、起動直後は空欄にして、一行50文字で三行表示します。<br>
さらに詳細は、cssファイルで指定してあります。
</p><p>
<pre class="brush:html first-line:44;">
<!-- 文字盤　一行目 -->
<div class="flex">
<img id="000"  src="./img/talk0.png" >
<img id="00"   src="./img/00.png" >
<img id="1"    src="./img/1.png" >
<img id="6"    src="./img/6.png" >
<img id="a"    src="./img/a.png" >
<img id="ka"   src="./img/ka.png" >
<img id="sa"   src="./img/sa.png" >
<img id="ta"   src="./img/ta.png" >
<img id="na"   src="./img/na.png" >
<img id="ha"   src="./img/ha.png" >
<img id="ma"   src="./img/ma.png" >
<img id="ya"   src="./img/ya.png" >
<img id="ra"   src="./img/ra.png" >
<img id="wa"   src="./img/wa.png" >
</div>
</pre>
</p><p>
テキストエリアの下に文字盤の一行目を配置します。<br>
キートップの画像は、50X50の画像ファイルです。<br>
例えば、36行目のtalk0.pngは発話する顔のイラストです。
以下、空白、１、６、あ、か、さ、た、な、、、わ
と並べ、class="flex"を指定して、divでくくります。 <br>
flexはcssで設定された様式で細かく表示されます。この結果、この14種類の画像を画面横一列に均等に表示し、必要に応じて画像を拡大縮小します。
この機能を使うと、どの大きさのスマホ、タブレット、パソコン画面でも、発話シンボルから「わ」までの14個の押しボタンが画面幅に均等に表示できるようになります。
後は同じことを繰り返して、二行目、三行目、四行目、五行目を表示します。

</p><p>
<pre class="brush:html first-line:61;">
<!-- 文字盤　二行目  -->
<div class="flex">
<img id="bun"  src="./img/bun01.png" >
<img id="mojiban"   src="./img/katakana.png" >
<img id="2"    src="./img/2.png" >
<img id="7"    src="./img/7.png" >
<img id="i"    src="./img/i.png" >
<img id="ki"   src="./img/ki.png" >
<img id="si"   src="./img/si.png" >
<img id="ti"   src="./img/ti.png" >
<img id="ni"   src="./img/ni.png" >
<img id="hi"   src="./img/hi.png" >
<img id="mi"   src="./img/mi.png" >
<img id="yu"   src="./img/yu.png" >
<img id="ri"   src="./img/ri.png" >
<img id="wo"   src="./img/wo.png" >
</div>
<!-- 文字盤　三行目  -->
<div class="flex">
<img id="hai"  src="./img/hai.png" >
<img id="iie"   src="./img/iie.png" >
<img id="3"    src="./img/3.png" >
<img id="8"    src="./img/8.png" >
<img id="u"    src="./img/u.png" >
<img id="ku"   src="./img/ku.png" >
<img id="su"   src="./img/su.png" >
<img id="tu"   src="./img/tu.png" >
<img id="nu"   src="./img/nu.png" >
<img id="hu"   src="./img/hu.png" >
<img id="mu"   src="./img/mu.png" >
<img id="yo"   src="./img/yo.png" >
<img id="ru"   src="./img/ru.png" >
<img id="nn"   src="./img/nn.png" >
</div>
<!-- 文字盤　四行目  -->
<div class="flex">
<img id="ten"  src="./img/ten.png" >
<img id="maru" src="./img/maru.png" >
<img id="4"    src="./img/4.png" >
<img id="9"    src="./img/9.png" >
<img id="e"    src="./img/e.png" >
<img id="ke"   src="./img/ke.png" >
<img id="se"   src="./img/se.png" >
<img id="te"   src="./img/te.png" >
<img id="ne"   src="./img/ne.png" >
<img id="he"   src="./img/he.png" >
<img id="me"   src="./img/me.png" >
<img id="gb"   src="./img/gb.png" >
<img id="re"   src="./img/re.png" >
<img id="bar"  src="./img/bar.png" >
</div>
<!-- 文字盤　五行目  -->
<div class="flex">
<img id="zenbukesu"  src="./img/zenbukesu.png" >
<img id="kesu" src="./img/kesu.png" >
<img id="5"    src="./img/5.png" >
<img id="0"    src="./img/0.png" >
<img id="o"    src="./img/o.png" >
<img id="ko"   src="./img/ko.png" >
<img id="so"   src="./img/so.png" >
<img id="to"   src="./img/to.png" >
<img id="no"   src="./img/no.png" >
<img id="ho"   src="./img/ho.png" >
<img id="mo"   src="./img/mo.png" >
<img id="gc"   src="./img/gc.png" >
<img id="ro"   src="./img/ro.png" >
<img id="0000"  src="./img/000.png" >
</div>
&lt;/body>
&lt;/html>

</pre>
</p><p>
同じ方法を5回使って五行の文字盤を作っています。
このように工夫すると、少ない手数で大きなプログラムを作ることができ、効率よく仕事ができます。
htmlファイルはこれで終わりです。
</p>
<h2>２　cssファイル　style.css</h2>
<p>
style.cssは、スタイルシート、htmlで使用するおbジェctの表示について設定しています。
</p><p>

<pre class="brush:html first-line:1;">
p	{
      font-size: 20px;
      font: 20px/1.5 "ヒラギノ角ゴPro W3","Hiragino Kaku Gothic Pro",Osaka,“メイリオ”,Meiryo,"ＭＳ Ｐゴシック","MS PGothic",Arial,Helvetica,Verdana,sans-seri
      line-height : 1.5 ;
      margin: 5px 100px 15px 100px;
	}
</pre>
</p><p>
パラグラフの定義　Web文字盤で使用するフォントを指定している windowsでは、メイリオ、MSPゴシック、IOSではヒラギノ角ゴシック、いずれも20ポイント、行間1.5行で表示するように指定している。スマホやタブレットのではデフォルトフォントを使用している。
</p><p>
<pre class="brush:html first-line:7;">
textarea {
  width: 100%;
  box-sizing: border-box;
  margin: .1em 0;
  padding: .1em .5em;
  border-radius: 1em;
  border: 2px solid #aaa;
  font-size: 40px;
}
</pre>
</p><p>
textarea html43行にある文字表示部分　textareaの書式を定義しています。<br>
テキストエリアの幅は画面いっぱい。隙間を若干設け、角は丸くとり教会はポイント。その中に表示する文字は40ポイントに指定しています。
</p><p>
<pre class="brush:html first-line:16;">
.flex{
  padding: 0.2% 0;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  justify-content: space-around;
}
</pre>
</p><p>
class="flex"で指定した範囲の書式をここで指定しています。<br>
padding: 0.2% 0;　　これは画像の上下左右の空白部分（padding)の設定、上下には0．2%（やや空いている）、左右にはゼロ（接している）と設定しています。<br>
display: flex;　　display: flex;で、flexというレイアウトを使用できるように宣言しています。<br>
flex-direction: row;　　ここで配列方向を横方向、左から右に並べると指定しています。<br> 
flex-wrap: nowrap;　　図形を横一列に並べる（折り返ししない）よう指定しています。<br> 
justify-content: space-around;　　画像は余白をもって等間隔に配置されます。同時に画面幅に合わせて画像の大きさを調整しています。<br>
</p>
<div style="text-align: center;">
<img title="flexの効果" alt="flex" src="img/bigandsmall.png">
</div>

<p>
この数行があるので、多種多様な寸法のどの機械で同じように文字盤が表示できるようになっています。 例えば、上の図のようにパソコンでWeb文字盤を表示し、全画面表示、部分表示を切り替えたり、また表示ウインドウをマウスドラッグで変更しても、入力済み文字列（こんなふうにつくっています）の表示とレイアウトを維持したまま、リアルタイムで文字盤表示の調整が行なわれているのを見ることができます。
これでいろいろな寸法のスマホやタブレットやパソコンでもきちんと表示できるようになりました。
実はこの数行がかなり苦労したところです。
</p>
<h2>３　マニフェストファイル　manifest2.webmanifest</h2>
<p>
マニフェストファイルはウェブアプリに通常のアプリと類似の外見や挙動をさせるための設定が入っています。
</p><p>
<pre class="brush:html first-line:1;">
{
  "name": "Web Mojiban 4d",
  "short_name": "Web Moji 4d",
  "theme_color": "#2196f3",
  "background_color": "#c0c0c0",
  "display": "standalone",
  "orientation": "landscape",
  "start_url": "./hcj.html",
  "icons": [
    {
      "src": "./ico/talk192.png",
      "sizes": "192x192",
      "type": "image/png"
    }
  ]
}
</pre>
</p><p>
2,3行目は表示する名称<br>
4行目はタイトルバーの色<br>
5行目は背景の色<br>
6行目は全画面表示<br>
7行目は画面の向きは横配置　portrateなら縦配置　画面の向きは固定されます。<br>
8行目　アプリ起動時に最初に表示するページのURL<br>
9-15行目　使用するアイコンのファイル名、寸法、画像ファイルの種類です。　iOS　Safariではマニフェストファイルでの指定に対応していないため、htmlファイルの12行目で別途設定しています。
</p>
<h2>４　おわりに</h2>
<p>
Web文字盤を作成した、2020年ころはPWAへの対応も各社まちまちで、対応状況もイマイチ明らかではなく苦労したことを思い出します。その後オフラインウェブアプリが流行するにつれて、各社のブラウザの挙動が安定してきたように思います。
</p><p>
しかしここで紹介したコードには、この当時のiOSに対するツギハギパッチが目に付きます。もう数年立ちましたので、iOS対応の部分に今どきのやり方もあるのではないかと思います。
</p><p>
またわれこそはと思われる方は取り組んできてください。もしかしたらそこに大きな改善が見つかるかもしれません。その功績はその人の手柄です。
</p><p>
さて次回は、ついに、test.jsとsw.jsの解説にしたいと思います。
かなりの大きさなので、頑張りが必要です。次回もよろしくお願いします。
</p><p>

</p>
<h2>参考URL</h2>
<p>
<ul>
  <li>iOS 11でWeb Appが強化されたけど、またしてもメタタグがおかしい<br>
<a target="_blank" href="https://qiita.com/moroya/items/0dfab2aff52d3373ce39">https://qiita.com/moroya/items/0dfab2aff52d3373ce39</a></li>
  <li>HTMLで複数の画像を均等に横並びする方法を現役エンジニアが解説【初心者向け】<br>
<a target="_blank" href="https://magazine.techacademy.jp/magazine/34803">https://magazine.techacademy.jp/magazine/34803</a></li>

</ul>
</p>

<hr style="width: 60%; height: 5%; color: black;">
<p><span class="samples">2024/07/26　公開
</span></p>

<a href="../index.html" target="_self">
<p align="center">研究企画課リハ工学科にもどる</a>　←もくじはこちらです</p>

</body></html>
