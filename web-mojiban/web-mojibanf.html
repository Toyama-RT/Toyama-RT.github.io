<!DOCTYPE html>
<html lang="ja"><head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-82832782-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-82832782-3');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z7DXKP3EBK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z7DXKP3EBK');
</script>

  
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  
  <script type="text/javascript" src="../sh/scripts/shCore.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushXml.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushPlain.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushJScript.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushVb.js"></script>
  
  <link type="text/css" rel="stylesheet" href="../sh/styles/shCoreDefault.css">
  
  <script type="text/javascript">SyntaxHighlighter.all();</script>
  <title>Web 文字盤F｜富山県リハ病院こども支援センター</title>
  
  <style type="text/css">
<!--
      
p	{
      font-size: 20px;
      line-height : 1.75 ;
      margin: 15px 100px 15px 100px;
	}
h1 {
    text-align: center;
    }
h2 {
    text-align: left;
      margin-left: 100px;
    }
h3 {
    text-align: left;
      margin-left: 100px;
    }
h4 {
    text-align: left;
      margin-left: 120px;
    }
pre {
    font-size: 20px;
    margin: 5px 100px 15px 100px;
    }
address{
	margin:5px 100px 15px 100px;
}      
blockquote {
    position: relative;
      font-size: 20px;
      line-height : 1.5 ;
    padding: 5px 150px 8px 100px;
    box-sizing: border-box;
    font-style: italic;
}
ol {
}
ul {
}
li {
  margin-top: 5px; /* 上余白指定 */
  margin-bottom: 5px; /* 下余白指定 */
  margin-left: 100px; /* 左余白指定*/
  margin-right: 100px; /* 右余白指定 */
  font-size: 20px; /*リストのフォントの大きさ*/
}
button{
  margin-bottom:1rem;
  width:150px;
  height:100px;
}

span.samples {font-size: small; }
.syntaxhighlighter {
  width: 80% !important;
  margin: 1em 100px 1em 100px !important;
  position: relative !important;
  overflow: auto !important;
  font-size: 1.3em !important;
}

    #text1 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn1 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice1 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;

    }
    #text2 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn2 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice2 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;

    }
    #text3 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn3 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice3 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;
    }


-->
  </style>

</head><body>
<p align="center"><font size="5"><font size="5"><font size="3"><font color="#ff0000">かならずお読みください</font>→<a href="../cyuui.html" target="_self"><img alt="注意事項" src="../cyuuijikou.gif" border="0" height="29" width="78"></a></font></font></font></p>

<h1>Web 文字盤　１３</h1>
<h1>オフラインで<br>PWA、Web文字盤やWebToyを使用した際に<br>
効果音の音声ファイルが再生されない問題と<br>その暫定的解決方法</h1>
<div style="text-align: center;"><img alt="Chromeの開発者ツール" src="img/devtool.png" >
<br>Chromeを起動してF12キーで開発者ツールが開きます<br>
</div>

<h2>０　概要</h2>
<p>
Web文字盤を使用する際に文字盤の変更や文の変更をする時、効果音が聞こえます。またつみきやボールころがしなどのWebToyでは衝突したときに効果音が聞こえます。
</p><p>
しかし、2021年の7月頃からオンラインでは再生されるこれら効果音がオフラインでは再生されず聞こえなくなる事例が何件か発生しました。この問題はいずれも効果音だけで、Web文字盤の読み上げの声は問題なく聞こえます。
</p><p>
この件について調査検討の結果、この時期より新しいChromeやEdgeではこの問題が起きることがわかりました。尚、オフラインでのみ使用していてブラウザのアップデートもしていない場合にはこの問題は起きないようです。
</p><p>
現在のところ、ブラウザとしてFirefoxを使用するとこの問題を回避することができます。Firefoxを使用するとChromeの場合と区別できないほどそっくりに動きます。またインストールしても使用できます。オフラインでも効果音が出ます。画面に同じアイコンも表示されます。ただし、本来タブレットが回転しても表示が回転しないように作られているのですが、Firefoxではこの機能が正常に作動せず、表示が回転します。
</p><p>
効果音が今是非必要とお考えの場合は、この方法をおすすめします。
</p><p>
現在、各社ともブラウザの開発は頻繁に行われていて、バージョンも細かく上がっています。このせいで改善改良が急速に進む一方で、今回のように不具合が発生することもあります。今回の不具合も広く知らせることで、いち早く改善されることを期待しています。
</p><p>
詳しい説明は後日お送りする予定です。
</p>
<h2>１　更に詳しい説明　はじめに</h2>
<p>
せっかくの機会(？)ですので、まずWebアプリとは何か？Web文字盤はなぜWebアプリなのか？続いて、オンラインとオフラインの違いとメリットについて、さらに今回のトラブルとその原因究明と確認について、そして最後に今後の見通しについて説明していきます。
</p>
<h3>Webアプリとは</h3>
<p>
スマホユーザがアプリと呼んでいるのはアプリケーションプログラム、何かの作業をするプログラムです。略してアプリ。多くの場合所定の手順でインストールして使用します。パソコンの場合も同様です。
</p><p>
しかし慣れないと手順を忘れたり、間違ったりすることもあります。こうなると継続して安定的に使用するのも簡単には行きません。技術サポートも人材不足です。
</p><p>
一方、Webアプリでは特定のURLにアクセスするだけで使用できます。つまりあちこちのホームページを見るのと同じです。ということはスマホを持っている人のほとんどすべてがすでにやっています。さらにQRコードを使えばより簡単にできるのは皆さんご存知のとおりです。
</p><p>
また、従来のアプリは、Windows用、MacOS用、Android用、iOS用をそれぞれ別に作る必要がありましたが、Webアプリでは一種類作れば全部使えて、非常に効率的でオトクです。
</p>
<h3>オンラインとオフライン</h3>
<p>
しかしWebアプリにはインターネットに繋がっている場合（オンライン）でないと使えない欠点もあります。しかし 数年前にGoogle が提唱したプログレッシブウェブアプリ(Progressive web apps, PWA)のオフライン機能を追加すると、wifiがない、届かない、スマホの圏外、データ通信できない、あるいは節約したいなどの場合でも使用できるようになります。このような機能を備えたWebアプリのことをオフラインWebアプリと読んでいます。Web文字盤やWebToyはオフラインWebアプリです。ですから外出先でも、移動中でも使い続けることができます。
</p><p>
さて今回の問題です。何週間か前にオフラインでの動作確認をしていました。ふと気がつくと画像ファイルの表示、文の読み上げなどはできるのに、効果音などの音声ファイルが再生できていないことに気が付きました。はじめは何かの間違いかと思いましたが、調べてみるといろいろ変わったことに気が付きました。
</p>
<h2>２　実態の調査</h2>
<p>
周辺の機器で動作の確認を行いました。Windows10のパソコンではこの問題は確認できました。しかし普通パソコンはオフラインで使用するのは稀ですのでそのまま気がつくことはなかったかもしれません。
</p><p>
またAndroidのタブレットを何台か持っています。使用頻度が少ないので少し遅れて問題が出始めました。はじめのうちは正常だったタブレットもいつの間にか問題が起きるようになりました。日常的に使用しているスマホは常時オンラインなので気がつきませんでした。一方、ずっとオフラインで使用しているタブレットでは、この問題は起きませんでした。
</p><p>
はじめ正常だったのに、いつの間にか不具合がでるようになったようです。
</p>
<h2>３　現象の確認</h2>
<p>
Windows10のChromeで開発者ツール（F12で起動します）を使って動作を確認しました。オンラインでは関係するエラーは見られません。しかしオフラインに設定すると、音声ファイルが見つからないというエラーがバンバンでます。（このページのトップ画像参照）
</p><p>
ファイルが見つからないといえば、サービスワーカーの動作がうまく行っていない、特に特定のファイルとなれば、サービスワーカーへのファイル名の記入漏れやアップロード漏れが疑われます。実際、画像ファイルをアップロードし忘れると画面に白い空白が表示されます。音声ファイルを書き漏らすと起動時にエラーがでます。これまで何回もこのミスはしましたのでいまではすぐわかるようになりましたが、今回はエラーの出方がどうも違います。それでも繰り返しサービスワーカーを見直しましたが間違いは見つかりませんでした。
</p><p>
次にキャッシュストレージ(Cache Storage) の内容をみると、エラーがでて見つからないといっているファイルが存在することが確認できました。
</p><p>
サービスワーカーは必要なファイルをキャッシュストレージにしっかり保存しています。オフラインではネットからファイルを読み込みできませんのでその時はキャッシュストレージから必要なファイルを読み込みます。他のファイルは問題なくこの動作をしていますが、mp3ファイルでは『目の前にある』ファイルを見つけられないようです。ためしにwavファイルでも試しましたが同じでした。
</p><p>
なんとなく、わけありの予感がしはじめました。
</p><p>
そこで、ブラウザをEdgeに変更して同じことを試しました。すると全く同じエラーがでました。そうそういまのEdgeはChromeの親戚のChromiumをベースに開発されたのを思い出しました。
</p><p>
続いて、FireFoxに変更して同じことを試してみたところ.....あっさり問題なく動作しました。どうやら改善すべき問題点がChromeとEdgeにあるようです。
</p><p>
しかし今回のことだげで、FireFoxがマルでほかがバツとも言い切れません。現にFireFoxにはほかの改善すべき点も見つかりました。

ただただ、ブラウザを作るって簡単じゃないってことがまた今回もわかりました。今回の問題点が早く改善されることを期待しその時を待ちたいと思います。
</p>
<h2>４　おわりに</h2>
<p>
今回お話したPWAにはオフライン機能のほかに、Push機能もあります。これは画面に表示を出す機能です。広告などに使われたらうんざりしますね。
</p><p>
でもタイムリーに、『〇〇は終わりましたか？そのつぎは◇◇ですよ。』とか激しい振動を感じたら『おちついてね』などと表示して声掛けすれば、困っている人の役に立つのではないかと思います。道具を使っていても自分でなんとかできればそれはもう立派に自立でしょう。
</p><p>
なにはともあれオフライン機能を思うままに使いこなせるようになるのが先決です。あちらの中の人も大変そうですが、こちらもなかなか大変です。
</p>
<hr style="width: 60%; height: 5%; color: black;">
<p><span class="samples">2021/08/24　公開<br>
2021/09/02　追記
</span></p>

<a href="../index.html" target="_self">
<p align="center">研究企画課リハ工学科にもどる</a>　←もくじはこちらです</p>
</body></html>
