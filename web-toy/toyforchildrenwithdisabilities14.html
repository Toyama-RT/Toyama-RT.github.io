<!DOCTYPE html>
<html lang="ja"><head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-82832782-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-82832782-3');
</script>
  
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  
  <script type="text/javascript" src="../sh/scripts/shCore.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushXml.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushPlain.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushJScript.js"></script>
  
  <script type="text/javascript" src="../sh/scripts/shBrushVb.js"></script>
  
  <link type="text/css" rel="stylesheet" href="../sh/styles/shCoreDefault.css">
  
  <script type="text/javascript">SyntaxHighlighter.all();</script>
  <title>Toy14｜富山県リハ病院こども支援センター</title>
  
  <style type="text/css">
<!--
      
p	{
      font-size: 20px;
      line-height : 1.75 ;
      margin: 15px 100px 15px 100px;
	}
h1 {
    text-align: center;
    }
h2 {
    text-align: left;
      margin-left: 100px;
    }
h3 {
    text-align: left;
      margin-left: 100px;
    }
h4 {
    text-align: left;
      margin-left: 120px;
    }
pre {
    font-size: 20px;
    margin: 5px 100px 15px 100px;
    }
address{
	margin:5px 100px 15px 100px;
}      
blockquote {
    position: relative;
      font-size: 20px;
      line-height : 1.5 ;
    padding: 5px 150px 8px 100px;
    box-sizing: border-box;
    font-style: italic;
}
ol {
}
ul {
}
li {
  margin-top: 5px; /* 上余白指定 */
  margin-bottom: 5px; /* 下余白指定 */
  margin-left: 100px; /* 左余白指定*/
  margin-right: 100px; /* 右余白指定 */
  font-size: 20px; /*リストのフォントの大きさ*/
}
button{
  margin-bottom:1rem;
  width:150px;
  height:100px;
}

span.samples {font-size: small; }
.syntaxhighlighter {
  width: 80% !important;
  margin: 1em 100px 1em 100px !important;
  position: relative !important;
  overflow: auto !important;
  font-size: 1.3em !important;
}

    #text1 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn1 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice1 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;

    }
    #text2 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn2 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice2 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;

    }
    #text3 {
        width: 50%;
        height: 3em;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
        font-size: 1.4em;
        font-weight: 700;
    }
    #btn3 {
        background: -webkit-linear-gradient(top,#008dfd 30%,#0370ea 100%);
        color: white;
        text-shadow: 1px 1px 1px #076bd2;
        border-radius: 3px;
        border: 1px solid #076bd2;
        padding: 2px 25px;
        font-weight: 700;
        font-size: 20px;
    }
    #selectVoice3 {
        width: 200px;
        font-weight: 700;
        font-size: 20px;
    }


-->
  </style>

</head><body>
<p align="center"><font size="5"><font size="5"><font size="3"><font color="#ff0000">かならずお読みください</font>→<a href="../cyuui.html" target="_self"><img alt="注意事項" src="../cyuuijikou.gif" border="0" height="29" width="78"></a></font></font></font></p>

<h1>障害をもつこどもたちのためのおもちゃ　１４</h1>

<div style="text-align: center;">
<p>ースワイプのつくりかたー</p>
<img alt="あっちをむいたりこっちをむいたりしているしろいいぬ（こんな説明ではわかりませんね）" src="img/leftandrightturn.gif">

</div>

<h2>０　はじめに</h2>
<p>
以前、頭をなでるといぬがよろこぶおもちゃをつくり紹介しました。
</p><p>
このおもちゃには、
タッチパッドに触っている位置を測る機能を追加して、どこに触っているかわかるようにつくりました。
そしてあたまやせなかなど特定の位置にさわった時に、鳴き声の音声ファイルを再生したり、画像ファイルを切り替えて、しっぽをはね上げたり、ほえたりするようにプログラムして動かしています。
</p><p>
今回、スワイプを作るために、これを改良して次のような仕組みを考えました。
まずタッチした瞬間の座標を計測して記憶します。続いてスライドしている間も連続して計測し、最後に指を離した寸前の座標を記憶します。そしてその直後にこれらの値を比較してスワイプの方向を判定して、それぞれの場合に決められた動作をするという仕組みです。記憶したり比較したり判定したり動作したりするなんておもしろいですね。

</p>
<h2>１　仕組み、数式、アルゴリズム</h2>
<p>
言葉で考えた後は式にします。
まずタッチ開始の座標を、<br>
（startX, startY）<br>
とします。またタッチ終了時の座標を、<br>
（endX, endY)<br>
とします。
</p><p>
このとき座標原点はモニターの左上角で、x軸は右向き正、y軸は下向きが正になります。
単位はピクセルです。
</p><p>
ここで、スワイプの判定は<br>
startX > endX<br>
なら左スワイプ、<br>
startX < endX<br>
なら右スワイプとなります。
</p><p>
基本はこれでいいのですが、このままではもし意図せずさわった時などに本人はスワイプしたつもりがないのに動作してしまうことがあり、これはユーザを非常に不快にします。
しかしみなさんご存じのように触ったつもりがないのに触ってしまうことはタッチパッドではよくあることです。</p><p>
そこで定数limitを設けて、その値をこえて大きく動かした場合だけスワイプと判断するように改善を加えます。この例のようにうまくいかない場合に改善策を考えつくのも仕事を進める上で大切です。
</p><p>
startX ｰ endX > limitX<br>
の場合は左スワイプ<br>
endX ｰ startX > limitX<br>
の場合は右スワイプ<br>
とします。言うなる不感帯（ごく小さいスワイプは無視する）を設けると不可解な動きが抑えられ落ち着きが出てきます。落ち着きのない人はlimitの値が小さいのです。
</p><p>
以上のような仕組みでうまくいくでしょう。<br>
ちなみに、NHKのEテレで耳にする『アルゴリズム』という言葉は、『こうやったらうまくいく仕組み』を表す言葉です。体操ではありません。
</p><p>
ここまでで作業の手順と数式の扱いが決まりました。次は具体的に実行する方法を考えます。
</p><p>
おもちゃですので、これらの手順が一瞬で終了しないと困ります。また何回も何回もか繰り返しても、同じ動作を間違いなく繰り返すことも大切です。
このように単純で速さと正確さが必要な仕事は人間には向いていません。こんな仕事は機械にやらせるのがいいでしょう。
</p>
<h2>２　プログラム</h2>
<p>
このような場合は仕事をコンピュータにやらせましょう。スマホやタブレットは中身はコンピュータです。コンピュータに仕事をさせるにはプログラムが必要です。上で説明した仕組みを実現するプログラムファイルjavascript.jsを以下のように作りました。
</p><p>
</p><p>
<pre class="brush: js;">

console.log("Hello WhiteDog!");

let dir1 = 0;  //方向　正面 0, 右right 1, 左left -1
let limitX =50;//不感帯の設定
	let startX = null;
	let endX = null;
	let startY = null;
	let endY = null;

// Main
window.onload = function(){
	function handleMouseDown(e){//マウス押下、タッチ開始時の処理
		handleMouseMove(e);
		document.addEventListener("mousemove", handleMouseMove, true);
		document.addEventListener("touchmove", handleMouseMove, true);
		console.log("MouseDown");

		var clientX, clientY;
		if(e.clientX){
			startX = e.clientX; startY = e.clientY;
		}else if(e.changedTouches && e.changedTouches.length > 0){
			var touch = e.changedTouches[e.changedTouches.length - 1];
			startX = touch.clientX; startY = touch.clientY;
		}else{
		   return;
		}
		console.log("start =", startX, startY);
	}
	document.addEventListener("mousedown", handleMouseDown, true);
	document.addEventListener("touchstart", handleMouseDown, true);
	
	function handleMouseUp(){//マウス開放、タッチ終了時の処理
		document.removeEventListener("mousemove", handleMouseMove, true);
		document.removeEventListener("touchmove", handleMouseMove, true);
		console.log("MouseUp");

		console.log("start =", startX, startY);
		console.log("end   =", endX, endY);

		if ((startX - endX) > limitX){
		console.log("left");
		console.log("dir1 =", dir1);

			if (dir1 == 0){
      			var elemdog = document.getElementById("image_dog");
          			elemdog.src = "./turnctol.gif";
			dir1 = -1;
			} else if (dir1 == 1){
      			var elemdog = document.getElementById("image_dog");
          			elemdog.src = "./turnrtoc.gif";
			dir1 = 0;
                       setTimeout(function(){
                       elemdog.src = "./dogcentail.gif";
                       },2000);
			} else {
			}

		}else if ((endX - startX) > limitX) {
		console.log("right");
			if (dir1 == 0){
      			var elemdog = document.getElementById("image_dog");
          			elemdog.src = "./turnctor.gif";
			dir1 = 1;
			} else if (dir1 == -1){
      			var elemdog = document.getElementById("image_dog");
          			elemdog.src = "./turnltoc.gif";
			dir1 = 0;
                       setTimeout(function(){
                       elemdog.src = "./dogcentail.gif";
                       },2000);

			} else {
			}
		} else {
      		audioElem = new Audio();
      		audioElem.src = "./dog2.mp3";
      		audioElem.play();
		}
	}
	document.addEventListener("mouseup", handleMouseUp, true);
	document.addEventListener("touchend", handleMouseUp, true);

	function handleMouseMove(e){//マウス移動、タッチスライド時の処理
		var clientX, clientY;
		if(e.clientX){
			endX = e.clientX; endY = e.clientY;
		}else if(e.changedTouches && e.changedTouches.length > 0){
			var touch = e.changedTouches[e.changedTouches.length - 1];
			endX = touch.clientX; endY = touch.clientY;
		}else{
		   return;
		}
	};
};

</pre>
</p><p>

簡単に説明します。<br>
1行目　コンソールにHello WhiteDog!と表します。javascript.jsの読み込みミスがあると表示しませんので正常読込の確認<br>
2行目　犬の向きを示す変数を宣言　正面 0, 右right 1, 左left -1<br>
4行目　不感帯の大きさを設定、50ピクセル<br>
5-8行目　座標計測値の変数を宣言<br>
11行　ファイルの読み込み後自動的にこれが動く<br>
12-28行　マウス左クリックまたはタッチ開始時の処理<br>
　14-15行で83行のhandleMouseMoveを許可（計測開始）<br>
　16行　押下されたことをコンソールに表示<br>
　18-27行　座標値を計測し結果をコンソールに表示<br>

32-28行　マウス左クリック開放またはタッチ終了時の処理<br>
　33-34行で83行のhandleMouseMoveを禁止（計測停止）<br>
　35行　開放されたことをコンソールに表示<br>
　37-38　始点終点の座標値をコンソールに表示<br>
　40-56行　左スワイプ時の処理　40行に条件式<br>
　　45-46行　正面から左に向くアニメ<br>
　　49-50行　右から正面に向くアニメ<br>
　　52-54行　二秒後に正面を向きしっぽを振るアニメ<br>
　58-73行　右スワイプ時の処理　58行に条件式<br>
　　61-62行　正面から右に向くアニメ<br>
　　65-66行　左から正面に向くアニメ<br>
　　68-69行　二秒後に正面を向きしっぽを振るアニメ<br>
　74-78行　スワイプが少ない時の処理<br>
　　75-77行　吠える声の再生<br>
83-93行　マウスドラッグまたはタッチスライド時の処理<br>
　84-92行　連続で座標を計測する<br>

</p><p>
このプログラムでは、指で触れた位置の計測を一秒間で数十回やります。およそ人間の何百倍の速さです。
</p><p>
ここで昔の人が本気で自動車と競走したり、重機と力比べしたことが思い出されます。しかし自動車も重機もコンピュータも作ったのは人間、使うのも人間です。ですからプログラムを作るのは自動車運転と同様に、人間の素の力を大きく引き伸ばす便利な道具と考えていいでしょう。世の中にはスマホの召使いみたいなっている人もいるようですが、やはりスマホを召使いにして生活するほうがよほど便利ですね。
</p><p>
コンピュータを動かすプログラムにはいくつか種類があります。今回使用したJavaScriptという言語は、Webサイトを操作する用途で広く使われています。
上のプログラムには一部に日本語の説明がありますが、その部分以外は世界共通です。どこの国でも同じように読み、書き、つくりそして動かしています。
</p><p>
ちなみにいぬにも国籍？がありませんのでどこの国でも同じように吠えます。けんかもするし仲良くもします。まあこのようにいぬもプログラムも似たようなものです。
</p><p>
例えばこの文章も自動翻訳され外国の人に読まれているようです。
日本の人たちも海外のWebページの日本語翻訳版とは知らずに読んでいることもあります。
どうもこの人の日本語は変だなあと思ったら思い出してくださいもしかしたら自動翻訳かもしれません。（単に筆者の日本語が変なだけかもしれません）
</p>
<h2>３　おわりに</h2>
<p>
さて上で紹介したプログラムに取りかかる前に念のため、『JavaScript　スワイプ』で検索してこれまで類似の事例があるか調べてみました。（先達はあらまほしきことなり）
</p><p>
予想通りすでに取り組んでいる例が何件かみつかりました。そのうちの二件について
調べると両者は基本的には同じ方法を使っています。
</p><p>
配布サンプルを入手してテストした結果、
パソコンで使うにはブラウザの開発者ツールが必要なことがわかりました。
パソコンにスワイプはありませんからこれはこれで当然といえば当然です。
</p><p>
しかし
今回のおもちゃ作りはできるだけ多くの人に使いやすいように考えています。
いろいろなひとがいろいろな道具や方法でできるように遊べるようにしておきたいのでパソコンで使いにくいこの条件はこまります。
<br>
誰が悪いわけではなくすべてはこちらの事情です。結局これまでの方法を手直しして上で紹介したように作ることにしました。
</p><p>
また二番目のサイトのサンプルには、不感帯を追加する工夫が紹介してありましたので、この部分はありがたく頂戴しました。このように他の人のプログラムを見ると色々勉強になります。このような情報はnetに非常にたくさんありますので勉強材料には不自由しません。
</p><p>
今の段階ではどのやりかたいいのかはまだ判断できません。まずアイデアを形にして、使えるおもちゃの見込みをつけて、場数を踏んでから改善していけばいいと思います。
</p><p>
さて今回の手作りスワイプではいろいろ興味深いことも見つかりました。
例えば、<br>
startY - endY > limitY<br>
とすると上下方向のスワイプもできます。
</p><p>
これを利用すれば、左右方向は大きく動かせるが上下方向には大きく動かせないひとにもうまく適合できるかもしれません。さらに工夫すれば、ななめスワイプもうまく行くかもしれません。
</p><p>
また、複数のlimit値を設定して、大中小のスワイプを判別するのもいいでしょう。
</p><p>
このような工夫により限られた運動からより多くの情報を引き出す方法としてスワイプを見つめ直せたのも、手間をかけて手作りした成果です。
</p><p>
決められたマニュアルやレシピを大事にしていくのも結構ですが、その一方でこれまで見落としていた価値や可能性を見直して広げていくとりくみもしないと、いつまでたっても『失われた＊年』に終わりは来ないように思っています。
</p>

<h2>参考URL</h2>
<ul>
  <li>スワイプ／フリックしたときに処理を実行する<br>
<a target="_blank" href="https://gray-code.com/javascript/execute-processing-when-swipe-or-flick/">https://gray-code.com/javascript/execute-processing-when-swipe-or-flick/</a></li>

  <li>JS：JavaScriptでスワイプ処理をする<br>
<a target="_blank" href="https://dianxnao.com/javascriptでスワイプ処理をする/">https://dianxnao.com/javascriptでスワイプ処理をする/</a></li>

</ul>


<hr style="width: 60%; height: 5%; color: black;">
<p><span class="samples">2022/05/20　公開
</span></p>

<a href="../index.html" target="_self">
<p align="center">研究企画課リハ工学科にもどる</a>　←もくじはこちらです</p>

</body></html>
